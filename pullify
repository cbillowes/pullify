#!/bin/bash

show_help() {
  echo "Usage: $0 <command> [options]"
  echo "Commands: scan, init, status, pull"
  echo "Options:"
  echo "   --path PATH    Path to the repository directory (absolute or relative to $PWD)"
  echo "   -h, --help     Show this help message"
}

# Extract command as first argument
if [[ -z "$1" ]]; then
  show_help
  exit 1
fi

cmd="$1"
shift

# Parse remaining arguments
while [[ $# -gt 0 ]]; do
  case "$1" in
    -h|--help)
      show_help
      exit 0
      ;;
    --path)
      path="$2"
      shift 2
      ;;
    --path=*)
      path="${1#*=}"
      shift
      ;;
    *)
      echo "Unknown option: $1"
      show_help
      exit 1
      ;;
  esac
done

if [[ -z "$path" ]]; then
  show_help
  exit 1
fi

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
path="$PWD/$basename"
base=$(basename "$path")
repo_file="$script_dir/repos/$base.txt"

if [[ "$cmd" == "init" ]]; then
  bash "$script_dir/init.sh" "$path" "$repo_file"
elif [[ "$cmd" == "scan" ]]; then
  bash "$script_dir/scan.sh" "$path"
elif [[ "$cmd" == "pull" ]]; then
  bash "$script_dir/pull.sh" "$path" "$repo_file"
elif [[ "$cmd" == "status" ]]; then
  bash "$script_dir/status.sh" "$path" "$repo_file"
else
  show_help
  exit 1
fi
